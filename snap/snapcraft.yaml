%YAML 1.2
---
name: git-cola-brlin
version: 'replaced-by-version-script'
version-script: |
  set -eu

  upstream_version="$(
    git \
      -C parts/git-cola/src \
      describe \
      --always \
      --dirty=-d \
      --tags \
    | sed s/^v//
  )"

  packaging_revision="$(
    git \
      describe \
      --abbrev=4 \
      --always \
      --dirty=-d
  )"

  printf -- '%s' "${upstream_version}+pkg-${packaging_revision}"

summary: The highly caffeinated Git GUI
description: |
  git-cola is a powerful Git GUI with a slick and intuitive user interface.

confinement: devmode
grade: devel
icon: snap/gui/icon.png

apps:
  git-cola:
    command: desktop-launch git cola
    desktop: share/applications/git-cola.desktop
    plugs:
    - desktop
    - desktop-legacy
    - x11
    - unity7

    - home
    - removable-media

  git-dag:
    command: desktop-launch git dag
    desktop: share/applications/git-dag.desktop
    plugs:
    - desktop
    - desktop-legacy
    - x11
    - unity7

    - home
    - removable-media

parts:
  # Patches to fix other parts
  patches:
    source: snap/patches
    source-type: local
    plugin: dump

    # DISABLED: Bug #1775582 “`organize:{ /: another-dir/ }` causes the items under host root directory to be copied in another-dir” : Bugs : Snapcraft
    # https://forum.snapcraft.io/t/organize-another-dir-causes-the-items-under-host-root-directory-to-be-copied-in-another-dir/5806
    #organize:
        #/: patches/
    override-build: |
      set -eu

      snapcraftctl build

      mkdir \
        --parents \
        "$SNAPCRAFT_PART_INSTALL"/patches
      mv \
        "$SNAPCRAFT_PART_INSTALL"/*.diff \
        "$SNAPCRAFT_PART_INSTALL"/*.patch \
        "$SNAPCRAFT_PART_INSTALL"/*.sed \
        "$SNAPCRAFT_PART_INSTALL"/patches \
        || true # Empty patches folder is allowed
    stage:
    - patches/*
    override-prime: 'true'

  my-app:
    after:
    - patches

    # See 'snapcraft plugins'
    plugin: nil

    override-stage: |
      set -eu

      snapcraftctl stage

      sed \
        --file "${SNAPCRAFT_STAGE}"/patches/patch-desktop-entries.sed \
        --in-place \
        "${SNAPCRAFT_STAGE}"/share/applications/*.desktop
